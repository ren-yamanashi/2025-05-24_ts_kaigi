---
layout: default
---

<style scoped>
.slidev-vclick-hidden {
  display: none;
}
</style>

<div class="_bullet">

2. 末尾が`Error`の場合、AST から型情報を取得

- `typescript-eslint` の `getTypeAtLocation` <span v-click.hide="1">(※1)</span>
  - `TSESTree.Node` を `ts.Node` に変換し、 `ts.getTypeAtLocation` を呼び出す <span v-click.hide="1">(※2)</span>

```ts
export interface ParserServicesWithTypeInformation // ※ typescript-eslint 本家の実装
  extends ParserServicesNodeMaps,
    ParserServicesBase {
  // ...
  getTypeAtLocation: (node: TSESTree.Node) => ts.Type;
}
```

<div v-click="1" class="mt-5">

- `ParserServicesWithTypeInformation` を扱うには `getParserServices` を使用

```ts
import { ESLintUtils } from "@typescript-eslint/utils"; // ※ カスタムルール作成時の実装

// parserServices: ParserServicesWithTypeInformation
const parserServices = ESLintUtils.getParserServices(context);
```

</div>

<div class="text-sm mt-1" v-click.hide="1">

※1: https://github.com/typescript-eslint/typescript-eslint/blob/v8.31.0/packages/typescript-estree/src/parser-options.ts#L249-L255

※2: https://github.com/typescript-eslint/typescript-eslint/blob/main/packages/website/src/components/linter/createParser.ts#L100-L103

</div>

</div>

<!--
typescript-eslint の `getTypeAtLocation` は、typescript-eslint の AST Node を受け取り、typescript の型情報を返す関数です。  

この関数は内部的に、`typescript-eslint` の AST Node を `typescript` の AST Node に変換した上で、 `typescript` の `getTypeAtLocation` を呼び出しています。  
また、この関数は`ParserServicesWithTypeInformation`という interface に含まれております。  

[click] そして、この `ParserServicesWithTypeInformation` を扱う場合は、`@typescript-eslint/utils` に含まれる ESLintUtils の `getParserServices`を呼び出します。
-->
