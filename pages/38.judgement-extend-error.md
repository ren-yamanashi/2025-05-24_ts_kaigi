---
layout: default
---

<style scoped>
.slidev-vclick-hidden {
  display: none;
}
.small-code {
  .slidev-code {
    font-size: 0.7rem !important;
  }
}
</style>

<div class="_bullet">

3. 取得した型情報と AST を元にチェック

</div>

<div v-click.hide="4" class="_bullet">

- 再起的に方情報を取得し、`Error` クラスを継承しているかを判定

</div>

<div v-click="1" v-click.hide="4" class="_bullet">

<div v-click="[1]" class="mt-14.5" />

<div v-click="2">

- `ts.Type` の `getBaseTypes` を使用し、親の型情報を取得

</div>

```ts{*|5|5-6}
const isExtendedError = (type: Type): boolean => {
  if (type.symbol.flags === SymbolFlags.Class && type.symbol.name === "Error") {
    return true;
  }
  const baseTypes = type.getBaseTypes() ?? [];
  return baseTypes.some((baseType) => isExtendedError(baseType));
};
```

</div>

<div v-click="4" class="_bullet small-code">

```ts{*}
import { ESLintUtils } from "@typescript-eslint/utils";
import { SymbolFlags, Type } from "typescript";

export const requireExtendsError = ESLintUtils.RuleCreator.withoutDocs({
  // ...
  create(context) {
    const parserServices = ESLintUtils.getParserServices(context);
    return {
      ClassDeclaration(node) {
        // 1. 定義されたクラス名の末尾が`Error`かを判定
        if (!node.id?.name.endsWith("Error")) return;

        // 2. 末尾が`Error`の場合、AST から型情報を取得
        const nodeType = parserServices.getTypeAtLocation(node);

        // 3. 取得した型情報と AST を元にチェック
        if (isExtendedError(nodeType)) return;
        context.report({
          node: node.id,
          messageId: "requireExtendsError",
        });
      },
    };
  },
});
```

</div>

<!-- 
続いて、型情報を辿って、定義されたクラスが`Error`を継承しているかを判定する実装を行います。

今回のルール実装では、自身の型情報のみではなく、クラスの継承元の型情報も必要となるため、再起的に親の型情報を取得し、`Error`クラスを継承しているかを判定する実装を行います。  
先ほどの`typescript`の`Type`という `interface`に、これを実現するためのメソッドがあるので、それを使用して、親の型情報を取得する実装を行います。

[click] 具体的なコードは、このようになります。
今回は`isExtendedError`という名前の関数を定義し、`Error`を継承している場合は true を返すようにしています。  
この関数では、`Type`,つまり型情報を見て、クラス名が`Error`の場合は、true を返すようにしています。

[click] また、`typescript`の`getBaseTypes`関数を使用して、親の型情報を取得し、  
[click] 再起的に`isExtendedError`関数を呼び出すようにしています。

ここまで実装できればあとは簡単で、この関数を実行し、Error を継承していない場合は、規約違反とみなすように実装します。  

[click] 全体的なコードはこちらのようになります

以上が、型情報を使用したカスタムリントルールの実装内容になります。
-->