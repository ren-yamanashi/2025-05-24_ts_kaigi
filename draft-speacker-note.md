それでは発表させていただきます。よろしくお願いします。

自己紹介です。山梨と申します  
株式会社メイツという会社で Web バックエンドエンジニアをしております  
プライベートでは、AWS CDK のコントリビュートをしたり、AWS CDK 用の ESLint プラグインを開発しています  

今回、表示されているタイトルでお話ししますが、このサブタイトルの「固有ドメインにおけるコーディング規約」とは、「皆さんが所属されている会社だったりチーム独自のコーディング規約、あるいは、特定のライブラリ・ツールのコーディング規約」を示します。  
そして、本セッションの目的とは、カスタムルールの開発手法を知り、より詳細な粒度でコーディング規約を自動化できるようにすることです。  

このセッションでは、そういったカスタムルール開発の理解を深めるためのお話を、段階的にいたします。  
具体的にはこちらの流れでお話しします。

最初に、ESLint や ESLint カスタムルールの概要についてお話しします。  
そして、ESLint カスタムルールの開発に不可欠である、AST の概要についてお話しします。  
AST というと難易度が高い印象を受ける方も多いかもしれませんが、今回は入門として、コードを例に挙げ、大まかな概要について触れます。  
その後、実際にシナリオを立てて、ESLint カスタムルールの開発、型情報を使用した カスタムルールの開発へと進みます。

まず、ESLint についてです

ESLint とは、JavaScript の Linterで、一貫性のあるコードを書くためだったり、コードの品質や安全性を高めることを目的として使用されると思います。  
このESLint の特徴としては、typescript-eslint という ESLint プラグインを追加することにより、TypeScript 構文がサポートされること、そして、カスタムルールなどの開発が可能で、拡張性が高い点が挙げられます。
カスタムルールと聞くとあまり普段触れていないように思えますが、例えばeslint-plugin-vue, eslint-plugin-react のような、普段使用しているライブラリやそのコミュニティによって提供されるプラグインも、カスタムルールの一つです。

ここからは、そのカスタムルールの概要について、まとめます。  
ESLint には、カスタムルールを作成するためのモジュール、インターフェースが提供されており、そのインターフェースに沿って記述することで、カスタムルールを開発することができます。  
ここで記述されたカスタムルールは、eslint が AST を走査する際にフックされ、呼び出されます。
そのため、ESLint から提供された AST を参照し、それを元に、特定の条件に従うかを判定する実装を行う。というのが、カスタムールール開発の主な内容になります。

例えば、チームのコーディング規約として、if文は必ず Block を使用したい。つまり波括弧で囲うようにしたいというユースケースがあると仮定した場合、カスタムルールの内容はこちらのコードのようになります。  
このコードでは、`node`という変数名で JavaScript の AST を受け取り、それに対する操作を行なっています。  
このように、ESLint のカスタムルールを実装する際には、ASTへの理解が求められます。  

そのため、ここからは、AST の概要についてお話しします。

AST とは、ソースコードをパースした抽象構文木のことで、JavaScript の場合は JSONとして表現されます。  
ソースコードからASTを生成する流れとしては、こちらの図のように、ソースコードを字句解析してトークンに分解し、そのトークンを構文解析してASTを生成するというようになります。

ここでの字句解析とは、ソースコードを予約語、変数名、記号などの、ある程度の意味の塊に分解することです。  
例えば、`let count = 10` というソースコードを字句解析すると、  
`let` と `count` と `=` と `10` と `;(セミコロン)` という単位に分解されます。

字句解析によって生成されたトークンは、構文解析器によって解析され、ASTが生成されます。  
ここで生成されるASTでは、スペースの数など、表面的な表現の違いが吸収され、コードの本質的な意味や構造だけを抽出して表現されます。  
ASTとはのAbstract Syntax Tree の略ですが、この Abstract, つまり抽象とは、そういった表面的な表現の違いに左右されないことを意味します
